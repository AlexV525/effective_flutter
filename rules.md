# Flutter å¼€å‘è§„èŒƒ

# TL;DR

- **ç¦æ­¢** å‡ºç°ä»»ä½•é”™è¯¯ï¼›
- **ç¦æ­¢** ä¸è¦å†™ `new` ï¼Œåœ¨ Dart 2.x ä¸­å·²ä¸å»ºè®®ç»§ç»­ä½¿ç”¨ `new` å…³é”®å­—ï¼›
- **å¿…é¡»** ç¼©è¿›ä¸º2ç©ºæ ¼ï¼›
- **å¿…é¡»** ä½¿ç”¨ `flutter format` ã€ `dartfmt` æˆ–è€… `dart format` å¯¹ä»£ç è¿›è¡Œæ ¼å¼åŒ–ï¼›
- **å¿…é¡»** ä½¿ç”¨ Flutter å®˜æ–¹ä»“åº“ä¸‹çš„ `analysis_options.yaml` ï¼ˆ[æ–‡ä»¶](https://github.com/flutter/flutter/blob/master/analysis_options.yaml)ï¼‰è¿›è¡ŒåŸºæœ¬ä»£ç è§„èŒƒçº¦æŸã€‚
- **å¿…é¡»** åœ¨è¾ƒé•¿ä»£ç å’ŒåµŒå¥—ä¸­ä½¿ç”¨å°¾é€—å·è¿›è¡Œæ‹†åˆ†ï¼Œé˜²æ­¢è¶…è¿‡80å­—æˆ–å‡ºç° `))))` ï¼›
- **å°½é‡** é¿å…å‡ºç°ä»»ä½•è­¦å‘Šï¼›
- **å°½é‡** é¿å…ä¸€è¡Œè¶…è¿‡80ä¸ªå­—ç¬¦ã€‚å¦‚æœè¶…è¿‡äº†ï¼Œè¯·æ£€æŸ¥æ˜¯å¦æœ‰ `))))` ï¼›
- **å°½é‡** é¿å…ç›´æ¥ä¿®æ”¹ Flutter æºç ï¼Œæˆ–ä¾èµ–çš„ package æºç ï¼›
- **å°½é‡** åœ¨é¡¹ç›®æ’æœŸå…è®¸çš„æƒ…å†µä¸‹ï¼Œå°†æ‰€æœ‰ packages ä¿æŒä¸ºå¯ä½¿ç”¨çš„æœ€æ–°ç‰ˆæœ¬ï¼›
- **æ¨è** åœ¨é¡¹ç›®æ’æœŸå…è®¸çš„æƒ…å†µä¸‹ï¼Œå°† Flutter SDK ä¿æŒä¸ºæœ€æ–°çš„**ç¨³å®šç‰ˆæœ¬**ï¼›

é™¤æ­¤ä¹‹å¤–ï¼Œä»¥ä¸‹æ˜¯å„ç±»è§„èŒƒçš„ç»†åˆ™ã€‚

# 1. æ–‡ä»¶ç±»è§„èŒƒ

## 1.1 å‘½åè§„èŒƒ

> å¯¹äºä¸€ä¸ªé¡¹ç›®è€Œè¨€ï¼Œè‰¯å¥½çš„æ–‡ä»¶å’Œç›®å½•å±‚çº§å¯è¯»æ€§ï¼Œä¿è¯äº†ä»£ç çš„å¥å£®ã€‚

ä¸€ä¸ª**æ™®é€šçš„ Flutter é¡¹ç›®**çš„ç›®å½•å±‚çº§ä¾‹å­å¦‚ä¸‹ï¼š

```
--flutter_project           # é¡¹ç›®æ ¹ç›®å½•

----/android, ios           # ç§»åŠ¨ç«¯åŸç”Ÿæ–‡ä»¶
----/web, macos, windows    # Webã€æ¡Œé¢å¹³å°å±‚æ–‡ä»¶

----/assets                 # èµ„æºæ–‡ä»¶
------/fonts                # å­—ä½“
------/images               # å›¾ç‰‡
------/others               # å…¶ä»–ç±»å‹èµ„æº

----/lib                    # é¡¹ç›®ä¸»è¦ä»£ç 
------/apis                 # æ¥å£å®šä¹‰ï¼Œå„ç±»è¯·æ±‚å°è£…
------/constants            # å¸¸é‡ã€ç»Ÿä¸€å¼•å…¥åŠå¯¼å‡ºå£å¾„
--------/constants.dart     # å„ç§ packageã€modelsã€apisã€widgets æœ€ç»ˆç»Ÿä¸€åˆ°æ­¤å¤„å¯¼å‡º
--------/resources.dart     # (å¯é€‰) å°†èµ„æºå¼•ç”¨è½¬æ¢æˆå¸¸é‡ (flutter_asset_generator)
------/extension            # é¡¹ç›®å†…å®šä¹‰çš„æ‰©å±•æ–¹æ³•
------/models               # Beansã€Modelsï¼Œç±»å®šä¹‰
--------/models.dart        # æ‰€æœ‰å†…å®¹ä½œä¸º partition è¿›è¡Œåˆ†å—
------/pages                # é¡µé¢
------/providers            # (å¯é€‰) çŠ¶æ€ä¿æŒ
------/utils                # å·¥å…·ç±»
------/widgets              # è‡ªå®šä¹‰ widget

----/analysis_options.yaml  # IDE ä»£ç åˆ†æé…ç½®

----/main.dart              # ä¸»å…¥å£

----/pubspec.lock           # å½“å‰ä¾èµ–åˆ°çš„ packages ç‰ˆæœ¬
----/pubspec.yaml           # Pub packages å£°æ˜æ–‡ä»¶
```

### 1.1.1 æ–‡ä»¶å‘½å

- **å¿…é¡»** æ‰€æœ‰æ–‡ä»¶ï¼ˆåŒ…æ‹¬èµ„æºï¼‰é‡‡ç”¨**å°å†™+ä¸‹åˆ’çº¿**å‘½åã€‚
   - `home_page.dart` 
- **å¿…é¡»** åŠŸèƒ½ç»„å‘½åæ—¶ï¼Œå¦‚æœä»£è¡¨ä¸€ç³»åˆ—åŒç±»çš„é›†åˆï¼Œä½¿ç”¨å¤æ•°è¯è¯­ã€‚
   -  `enums` , `models` 
- **å°½é‡** ä¸è¦ä½¿ç”¨**ä¸é¡¹ç›®æ— å…³**ä¸”**æ²¡æœ‰å…±è¯†**çš„**ç¼©å†™**ç”¨äºæ–‡ä»¶å‘½åã€‚
   -  `wlck_page.dart`
- **å°½é‡** åˆ†è¯æ—¶**ä¿¡ã€é›…ã€è¾¾ã€‚**
   - `user_edit_profile_page.dart`

### 1.1.2 ç±»å‘½å

ä¸€ä¸ªç±»åº”ç›´æˆªäº†å½“åœ°è¡¨æ˜å…¶**å†…å®¹+èº«ä»½+ç”¨é€”**ã€‚

- **å¿…é¡»** ä½¿ç”¨å¤§é©¼å³°å‘½åã€‚åŒæ ·é€‚ç”¨äº**æšä¸¾**å’Œ**æ‰©å±•å‡½æ•°**ã€‚
   - `class Foo` , `extension Bar<T>` 
- **å¿…é¡»** è¶…è¿‡ä¸¤ä¸ªå­—æ¯çš„å¤§å†™ç¼©ç•¥è¯å½“åšä¸€èˆ¬å•è¯å¯¹å¾…ã€‚ä¸¤ä¸ªå­—æ¯çš„å•è¯é™¤å¤–ã€‚
   - `HttpConnectionInfo` , `IOStream` , `Id`  âœ…
   - `HTTPConnection` , `IoStream` , `ID`  ğŸš«
- **å¿…é¡»** åœ¨å¯¼å…¥åº“æ—¶ï¼Œä½¿ç”¨**å°å†™+ä¸‹åˆ’çº¿**çš„åˆ«åã€‚
   -  `import 'dart:math' as math` 
- **å°½é‡** ä¸è¦è¶…è¿‡5ä¸ªå•è¯ã€‚å¦‚æœè¶…è¿‡äº†ï¼Œåº”è¯¥è€ƒè™‘æ˜¯å¦ä¸ºå‘½åæˆ–æ‹†åˆ†ä¸å½“ã€‚

### 1.1.3 å˜é‡å‘½å

- **å¿…é¡»** ä½¿ç”¨**å°é©¼å³°**å‘½åã€‚
   -  `int imagesLength` 
   -  `List<AssetEntity> selectedAssets` 
- **å¿…é¡»** ä¸è¦è¶…è¿‡5ä¸ªå•è¯ã€‚
- **å¿…é¡»** å¸ƒå°”ç±»å‹å˜é‡ä½¿ç”¨å‰ç¼€ `is` æˆ– `should` ã€‚
   - `bool isLoading`
- **å¿…é¡»** å¦‚æœä¸€ä¸ªå˜é‡ä¸æ˜¯ç§æœ‰å˜é‡ï¼Œä¸è¦ä½¿ç”¨ `_` ä½œä¸ºå‰ç¼€ï¼Œå› ä¸º Dart ä¸­æ²¡æœ‰ç§æœ‰çš„æ¦‚å¿µã€‚
- **å°½é‡** é™¤äº†è¡¨ç¤ºçŠ¶æ€çš„å¸ƒå°”å€¼ï¼Œå…¶ä»–å˜é‡ä½¿ç”¨åè¯è¿›è¡Œå‘½åã€‚
   -  `double width` 
   - `Widget separator` 
- **å°½é‡** ä¸è¦ä½¿ç”¨å‰ç¼€å­—æ¯ã€‚ï¼ˆ `k` æ˜¯ Flutter å†…å®šçš„å‰ç¼€ã€‚ï¼‰
   -  `kDefaultTimeout` 
- **å°½é‡** ä¸è¦åŒæ—¶å‘½åå¤šä¸ªæ¥è¿‘ä¸”å…·æœ‰è¿·æƒ‘æ€§çš„å˜é‡ã€‚
   -  `tabIndex` , `tabCurrentIndex` 

# 2 ç”¨æ³•è§„èŒƒ

## 2.1 import/export

- **å¿…é¡»** æŒ‰ç…§å­—æ¯è¡¨é¡ºåºè¿›è¡Œ import/exportã€‚
- **å¿…é¡»** å°† `dart:` æ”¾åœ¨æœ€å‰ã€‚
- **å¿…é¡»** å°† `package:` æ”¾åœ¨ç›¸å¯¹å¼•ç”¨ä¹‹å‰ã€‚
- **å¿…é¡»** å°† Flutter çš„ package æ”¾åœ¨å…¶ä»– package ä¹‹å‰ã€‚
- **å¿…é¡»** å°† export æ”¾åœ¨æ‰€æœ‰ import ä¹‹åã€‚
- **å°½é‡** é¿å…åœ¨æ„å»ºä¸€èˆ¬é¡µé¢æ—¶ï¼Œå°† package çš„ **src** å¼•å…¥ã€‚é™¤éä½ æ­£åœ¨å¯¹ä¸€ä¸ªå®˜æ–¹ç»„ä»¶è¿›è¡Œå®šåˆ¶ã€‚[implementation_imports](https://dart-lang.github.io/linter/lints/implementation_imports.html)

## 2.2 æ„é€ æ–¹æ³•

æ„é€ æ–¹æ³•æ˜¯ OOP è¯­è¨€ä¸­æœ€å¸¸ç”¨çš„æ–¹æ³•ä¹‹ä¸€ã€‚åœ¨ Dart + Flutter ä¸­ï¼Œä¾ç…§å„é¡¹è§„åˆ™çš„é™åˆ¶ï¼Œä¸€èˆ¬å¯¹æ„é€ å‡½æ•°æœ‰ä»¥ä¸‹å‡ ç‚¹è¦æ±‚ï¼š

- **å¿…é¡»** æ‰€æœ‰**æ„é€ å‡½æ•°**å’Œ**å·¥å‚æ–¹æ³•**éƒ½è¦å†™åœ¨ç±»çš„**å¼€å¤´ä½ç½®**ï¼Œè€Œåæ‰æ˜¯å˜é‡å£°æ˜ã€‚
- **å¿…é¡»** `StatefulWidget` çš„æ„é€ å­—æ®µå¿…é¡»ä¸ºç»ˆå€¼ `final` ã€‚(@immutable)
- **å¿…é¡»** `Widget` çš„æ„é€ å¿…é¡»å¸¦æœ‰å‘½åå¯é€‰å‚æ•° `Key key` ã€‚
- **å¿…é¡»** å¦‚æœæ„é€ éœ€è¦3ä¸ªåŠä»¥ä¸Šçš„å‚æ•°ï¼Œæˆ–ä½œä¸ºä¸€ä¸ª `Widget` çš„æ„é€ ï¼Œè¯·å°†å®ƒä»¬è½¬ä¸ºå‘½åå¯é€‰å‚æ•°ã€‚
- **å¿…é¡»** å•ä¾‹ä½¿ç”¨ç§æœ‰æ„é€ ã€‚ï¼ˆä¾‹ï¼š `const API._()` ï¼‰
- **å¿…é¡»** ä¸ºæ‰€æœ‰è‡ªå®šä¹‰çš„ç±»å®ç° `toString()` ã€‚
- **å°½é‡** å¦‚æœ `Widget` çš„å­—æ®µå‡ä¸ºç»ˆå€¼ä¸”æ²¡æœ‰æ„é€ å›è°ƒï¼Œå°†æ„é€ æ–¹æ³•åŠ ä¸Š `const` ã€‚
- **å°½é‡** æœ‰å¯èƒ½ç”¨äº `Iterable*`  çš„ç±»ï¼Œè¯·é‡å†™ `operator ==` å’Œ `hashCode` ã€‚
- **æ¨è** ä½œä¸º Provider Model çš„ `ChangeNotifier` ï¼Œå­—æ®µä½¿ç”¨ getter & setterã€‚
- **æ¨è** ä¸€ä¸ªç”± json æ•°æ®è½¬æ¢è€Œæ¥çš„å®ä½“ç±»ï¼Œè¯·å®ç° `Map<String, dynamic> toJson()` ã€‚

æ ¹æ®ä¸Šè¿°è¦æ±‚ä¸¾ä¸¤ä¸ªä¾‹å­ï¼š

```dart
class Person {
  const Person({
    this.name = 'Alex',
    this.age = 23,
    this.skills,
  });

  factory Person.fromJson(Map<String, dynamic?> json) {
    return Person(
      name: json['name'] as String,
      age: json['age'] as int,
      skills: json['skills'] as List<String>?,
    );
  }

  final String name;
  final int age;
  final List<String>? skills;

  @override
  bool operator ==(Object other) {
    if (identical(other, this)) {
      return true;
    }
    if (other.runtimeType != runtimeType) {
      return false;
    }
    return name == other.name
        && age == other.age
        && skills == other.skills;
  }

  @override
  int get hashCode => hashValues(name, age, skills);
}
```

```dart
class PersonalPage extends StatefulWidget {
  const PersonalPage({
    Key key,
    @required this.person,
  }) : super(key: key);

  final Person person;

  ///...///
}
```

## 2.3 å˜é‡å£°æ˜ã€ä½¿ç”¨ã€è°ƒç”¨

- **ç¦æ­¢** ä¸è¦ä½¿ç”¨ `var` , `Object` ï¼Œ**åœ¨ç¡®å®šå˜é‡æ—¶å¿…é¡»ç¡®å®šå®ƒçš„ç±»å‹**ã€‚
- **ç¦æ­¢** ä¸è¦ä½¿ç”¨**é­”æ•°**ã€‚å¦‚æœå®ƒæ˜¯ä¸€ç§ç±»å‹è¡¨ç¤ºï¼Œç›´æ¥å°†å®ƒä»¬**å®šä¹‰ä¸ºæšä¸¾**ã€‚
- **å¿…é¡»** é¿å…æ™®éåœ°ä½¿ç”¨ç¼©å†™ï¼Œé™¤éæ˜¯ç±»ä¼¼è¡¨ç¤ºåç§»çš„ `x` ã€‚
   -  `i` -> `index` 
- **å¿…é¡»** åœ¨å£°æ˜æ—¶å°†ç±»å‹å†™æ˜ï¼Œ**åŒ…æ‹¬æ³›å‹**ã€‚[always_specify_types](https://dart-lang.github.io/linter/lints/always_specify_types.html)
   - `Map<String, dynamic> json` 
   - `Column(children: <Widget>[])` 
- **å¿…é¡»** ä½¿ç”¨ `final` å£°æ˜**æ— éœ€æ”¹åŠ¨**çš„**åŸºæœ¬ç±»å‹**ã€**æ— éœ€é‡æ–°åˆ›å»ºå®ä¾‹**çš„**éåŸºç¡€ç±»å‹**çš„å˜é‡ã€‚
   - `final int userId = 0` 
   - `final ScrollController controller = ScrollController()` 
   - `final List<AssetEntity> selectedAssets = <AssetEntity>[]` 
- **å¿…é¡»** ç©ºå®‰å…¨ é™¤äº† Model ä»¥å¤–ï¼Œä¸è¦æ»¥ç”¨ `?` ï¼Œåœ¨å£°æ˜æ—¶å°±ç¡®å®šæ˜¯å¦å¯ç©ºã€‚

### 2.3.1 å¸ƒå°”å€¼

- **ç¦æ­¢** ä¸è¦å†™å¸ƒå°”è½¬å¸ƒå°”çš„è¯­å¥ã€‚
   -  `return list.isEmpty ? true : false`
- **å¿…é¡»** éç©ºå®‰å…¨ ä½¿ç”¨ `??` å°†å¯èƒ½ä¸ºç©ºçš„å¸ƒå°”å€¼è½¬æ¢ä¸ºä¸ä¸ºç©ºçš„å€¼ã€‚
   - `list?.isEmpty ?? true` 
- **å°½é‡** ä¸ºå€¼èµ·**è‚¯å®šå½¢å¼**çš„åå­—ã€‚å¦‚æœåœ¨ä½¿ç”¨å®ƒæ—¶æ€»æ˜¯å–åï¼Œè¯·è€ƒè™‘å–åå‘æ„ä¹‰çš„åå­—ã€‚

### 2.3.2 æšä¸¾

- **ç¦æ­¢** `switch` ä¸­åˆ—å‡ºæ‰€æœ‰çš„æšä¸¾å€¼ï¼Œä¸è¦ç”¨ `default` ã€‚
- **å¿…é¡»** ä½¿ç”¨ `switch` è€Œä¸æ˜¯ `if` æ¥åˆ¤æ–­æšä¸¾å†…å®¹ã€‚

### 2.3.3 å­—ç¬¦ä¸²

- **å¿…é¡»** æ‹¼æ¥å­—é¢é‡å­—ç¬¦ä¸²æ—¶ä½¿ç”¨ä¸´è¿‘å­—ç¬¦ä¸²ï¼Œè€Œä¸ç”¨ `+` ã€‚[prefer_adjacent_string_concatenation](https://dart-lang.github.io/linter/lints/prefer_adjacent_string_concatenation.html)
- **å¿…é¡»** ä½¿ç”¨æ’å€¼ç»„åˆå­—ç¬¦ä¸²ã€‚[prefer_interpolation_to_compose_strings](https://dart-lang.github.io/linter/lints/prefer_interpolation_to_compose_strings.html)
- **å¿…é¡»** é¿å…åœ¨å­—ç¬¦ä¸²æ’å€¼ä¸­ä½¿ç”¨ä¸å¿…è¦çš„å¤§æ‹¬å·ã€‚[unnecessary_brace_in_string_interps](https://dart-lang.github.io/linter/lints/unnecessary_brace_in_string_interps.html)

### 2.3.4 é›†åˆ

- **å¿…é¡»** `List` , `Set` , `Map` ä½¿ç”¨å­—é¢é‡æ„é€ å®ä¾‹ã€‚[prefer_collection_literals](https://dart-lang.github.io/linter/lints/prefer_collection_literals.html)ã€‚
   - `<T>[]` , `<T>{}` , `<T, S>{}` 
- **å°½é‡** `Iterable*` åˆå§‹åŒ–ä¸ºç©ºçš„é›†åˆã€‚
   -  `List<int> list = <int>[]` 
- **å°½é‡** é¿å…ä½¿ç”¨ `toList()` å’Œ `List.cast` ï¼Œä½¿ç”¨ `List.from` ã€‚
   - ä»…åœ¨æ”¹å˜ç±»å‹å’Œä»å¯è¿­ä»£å¯¹è±¡ç”Ÿæˆ `List` æ—¶ä½¿ç”¨ï¼Œå…¶ä»–æ—¶é—´å‹¿ç”¨ã€‚
- **å°½é‡** ä½¿ç”¨**å±•å¼€æ“ä½œç¬¦**æ„é€ æ–°çš„ `Iterable` ã€‚
   - `final List<int> anotherList = <int>[...list]` 
- **æ¨è** ä½¿ç”¨**çº§è”æ“ä½œç¬¦**å¯¹åŒä¸€ä¸ªå¯¹è±¡è¿›è¡Œè¿ç»­è°ƒç”¨ã€‚
   -  `list..add(x)..add(y)`

### 2.3.5 å±€éƒ¨å˜é‡


